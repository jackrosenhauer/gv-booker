<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>GV Booker</title>
    <link rel="stylesheet" type="text/css" href="bower_components/normalize-css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>

    <!--Main Nav-->
    <nav id="nav">
        <div id="login-message"></div>
        <input id="login-username" type="text" placeholder="Username">
        <input id="login-password" type="password" placeholder="Password">
        <input id="login" type="button" value="Log In">
        <input id="register" type="button" value="Register">
    </nav>

    <!--Don't think we'll ever change this, no template needed-->
    <aside id="filter">
        <h3>Room Option Filter</h3>
        Please check boxes according to room needs. Calendar will show openings.
        <div id="roomoptions" style="">
            <input type="number" id="seating-selection" min="1" max="10">
            <label for="seating-selection"># of seats</label><br>

            <input type="checkbox" id="whiteboard-selection">
            <label for="whiteboard-selection">Whiteboard?</label><br>

            <input type="checkbox" id="phone-selection">
            <label for="phone-selection">Phone?</label><br>

            <input type="checkbox" id="tv-selection">
            <label for="tv-selection">TV?</label><br>

            <input type="checkbox" id="webcam-selection">
            <label for="webcam-selection">Webcam?</label><br>
        </div>
    </aside>

    <!-- Body / calendar-window will have main content like the various views, registration page, admin section etc-->
    <article id="calendar-window" class="floatleft">

        <div id="calendar-bar">
            <div id="bar-title">
                Description of the page goes here: day, week or month view.
            </div>

            <!--Calendar nav buttons -->
            <div style="width: auto; float: right;">
                <input id="prev-button" type="button" value="<">
                <input id="next-button" type="button" value=">">
                <input id="view-button" type="button" value="week v123123iew">
            </div>
        </div>

        <div id="calendar-body">
            The calendar view. This is just a placeholder.
        </div>
    </article>
</body>
<!-- scripts go at the end for performance  -->

<!-- Bower components and templates -->
<script src="bower_components/handlebars/handlebars.js"></script>

<!-- MVC files -->
<script src="js/validator.js"></script>
<script src="js/helpers.js"></script>
<script src="js/model.js"></script>
<script src="js/view.js"></script>
<script src="js/controller.js"></script>
<script src="js/store.js"></script>
<script src="js/app.js"></script>

<script id="login-template" type="text/x-handlebars-template">
    <div id="login-message"></div>
    <input id="login-username" type="text" placeholder="Username">
    <input id="login-password" type="password" placeholder="Password">
    <input id="login" type="button" value="Log In">
    <input id="register" type="button" value="Register">
</script>

<script id="register-template" type="text/x-handlebars-template">
    <div>
        <input id="register-username" type="text" placeholder="Username">
        <input id="register-password1" type="text" placeholder="Password">
        <input id="register-password2" type="text" placeholder="Reenter Password">
        <input id="register-email" type="text" placeholder="email">
        <input id="register-submit" type="button" value="Register">
        <input id="register-clear" type="button" value="Clear Form">
        <input id="register-cancel" type="button" value="Cancel">
    </div>
</script>

<script id="available-reservation" type="text/x-handlebars-template">
    <div class="reservation available-reservation">
        <div>Available</div>
        <div>BLDG: {{building}}</div>
        <div>RM: {{roomNumber}}</div>
    </div>
</script>

<script id="unavailable-reservation" type="text/x-handlebars-template">
    <div class="reservation unavailable-reservation">
        <div>Unavailable</div>
        <div>User: {{user}}</div>
        <div>Starting: {{start}}</div>
        <div>Ending: {{end}}</div>
        <div>BLDG: {{building}}</div>
        <div>RM: {{roomNumber}}</div>
    </div>
</script>


<script id="loggedin-template" type="text/x-handlebars-template">
    <div>
        logged in a: {{username}}
        <input id="logout" type="button" value="Logout">
    </div>
</script>

<script id="month-template" type="text/x-handlebars-template">
    <div class="week_row">
        <div class="calendar-day-container">
            <div class="calendar-day-wrapper">
                <div class="calendar-day-number">{{day}}</div>
                <div class="calendar-day-data">{{data}}</div>
            </div>
        </div>
    </div>
</script>

<script id="week-template" type="text/x-handlebars-template">
    <div>insert a week template here</div>
</script>

<script id="day-template" type="text/x-handlebars-template">
    <div>insert a day template</div>
</script>

<script id="bar-template" type="text/x-handlebars-template">
    <!-- <div class="bar-title" style="float: left; font-size: 32px; font-color: blue; padding: 10px;">{{month}}, {{day}} {{year}}</div> -->
    <div id="bar-title" style='text-align: center; float:left;'>{{month}}, {{day}} {{year}}</div>
    <input id="prev-button" style="float: right;" type="button" value="<">
    <input id="next-button" style="float: right;" type="button" value=">">
    <input id="viewMonth-button" style="float: right;" type="button" value="month view">
    <input id="viewWeek-button" style="float: right;" type="button" value="week view">
    <input id="viewDay-button" style="float: right;" type="button" value="day view">
</script>

<script>
    var calBar = document.getElementById("calendar-bar");
    var calBarTitle = document.getElementById("bar-title");
    var calBody = document.getElementById("calendar-body");

    var defaultStartTime = {
        "hours": 8,
        "minutes": 0
    };
    var defaultEndTime = {
        "hours": 23,
        "minutes": 0
    };

    function weekView(month, day, year) {
        var html = '<table>';
        html += '<tr>';
        html += '<td>Sunday</td>';
        html += '<td>Monday</td>';
        html += '<td>Tuesday</td>';
        html += '<td>Wednesday</td>';
        html += '<td>Thursday</td>';
        html += '<td>Friday</td>';
        html += '<td>Saturday</td>';
        html += '</tr>';

        html += '</table>';
        return html;
    }


    function dayView(month, day, year, defaultStartTime, defaultEndTime) {
        //nav
        var self = this;
        var startDate = new Date(year, month, day, defaultStartTime.hours, defaultStartTime.minutes);
        var endDate = new Date(year, month, day, defaultEndTime.hours, defaultEndTime.minutes);

        var source = document.getElementById("bar-template").text;
        var template = Handlebars.compile(source);
        var context = {
            "month": month,
            "day": day,
            "year": year
        };

        console.log(template(context));
        calBar.innerHTML = template(context);

        //cal body
        source = document.getElementById("day-template").text;
        template = Handlebars.compile(source);

        context = {
            start: defaultStartTime,
            end: defaultEndTime
        };


        // var html = '<table class="day-table">';
        // var times = getArrayOfTimes(startDate, endDate);
        // for (var i = 0, len = times.length; i < len; i++){
        //   console.log(times[i]);
        //   //i % 5 is where the # of openings should go
        //   html += '<tr><td>' + times[i] + '</td><td>' + i % 5 + '</td></tr>';
        // }
        //
        // html += '</table>';
        console.log(html);

        var html = "<table style='height: 100%; width: 100%; background-color: red;'>";

        var times = getArrayOfTimes(startDate, endDate);
        for (var i = 0, len = times.length; i < len; i++) {
            html += "<tr style='width: auto; height: auto;'>";
            html += "<td style='float: left; width: 20%; text-align: center; background-color: lime;'>" + times[i] + "</td>";
            html += "<td style='float: left;'>" + times[i] + "</td>";
            html += "</tr>";
        }

        html += "</table>";

        calBody.innerHTML = html;
        return html;
    }



    function getMinutes(date) {
        return date.getHours() * 60 + date.getMinutes();
    }
    // document.getElementsByTagName("body")[0].innerHTML = html;
    function addMinutes(date, minutesToAdd) {
        var totalMils = date.getTime() + minutesToAdd * 60 * 1000;
        return new Date(totalMils);
    }

    function addHours(date, hoursToAdd) {
        return new Date(date.getTime() + hoursToAdd * 60 * 60 * 1000);
    }

    function addDays(date, daysToAdd) {
        return new Date(date.getTime() + hoursToAdd * 24 * 60 * 60 * 1000);
    }

    //starting and ending time in minutes
    //480 to 510
    function getArrayOfTimes(startDate, endDate) {
        var times = [];
        while (endDate >= startDate) {
            times.push(startDate.toLocaleString().split(", ")[1]);
            startDate = addMinutes(startDate, 30);
        }
        return times;
    }

    app.controller.init();

//    //setup data, run this once! It will save to local storage after
    localStorage.clear();
    app.model.createUser("test", "test", "test@fake.com", 0);
    app.model.createUser("test", "test", "test@fake.com", 0);
    app.model.deleteUser("test");
    app.model.createUser("test", "test", "test@fake.com", 0);

    var testUsername = app.model.getUser("test").username;

    app.model.createRoom("MAK", "C-2-206", 31, false, false, false, false);
    app.model.createRoom("MAK", "C-2-208", 5, false, false, false, false);
    app.model.createRoom("MAK", "C-2-210", 20, false, false, false, false);
    app.model.createRoom("MAK", "C-2-210", 20, false, false, false, false);
    app.model.deleteRoom("MAK", "C-2-210");
    app.model.deleteRoom("MAK", "C-2-210");
    app.model.createRoom("MAK", "C-2-210", 20, false, false, false, false);


    //dates 9am to 9:30 am
    var d = new Date(2015, 10, 11, 9, 0);
    var d1 = new Date(2015, 10, 11, 9, 30);
    //start and end dates 8am - 11pm
    var d2 = new Date(2015, 10, 11, 8);
    var d3 = new Date(2015, 10, 11, 23);
    //start and end dates, 8am to 8:30am
    var d4 = new Date(2015, 10, 11, 10, 0);
    var d5 = new Date(2015, 10, 11, 10, 30);
    //start and end dates, 8am to 8:30am
    var d6 = new Date(2015, 10, 10, 10, 0);
    var d7 = new Date(2015, 10, 10, 10, 30);

    //create reservations
    app.model.createReservation("MAK", "C-2-206", testUsername, d.valueOf(), d1.valueOf());
    app.model.createReservation("MAK", "C-2-208", testUsername, d.valueOf(), d1.valueOf());
    app.model.createReservation("MAK", "C-2-210", testUsername, d.valueOf(), d1.valueOf());

    //already exists
    app.model.createReservation("MAK", "C-2-206", testUsername, d.valueOf(), d1.valueOf());
    //invalid room
    app.model.createReservation("ABC", "C-2-209", testUsername, d.valueOf(), d1.valueOf());

    //deletes success
    app.model.deleteReservation("MAK", "C-2-206", d.valueOf());
    app.model.deleteReservation("MAK", "C-2-208", d.valueOf());
    app.model.deleteReservation("MAK", "C-2-210", d.valueOf());

    //reservation did not exist (it's actually deleted)
    app.model.deleteReservation("MAK", "C-2-206", d.valueOf());


    app.model.createReservation("MAK", "C-2-206", testUsername, d.valueOf(), d1.valueOf());
    app.model.deleteReservation("MAK", "C-2-206", d.valueOf());

    //create 5 reservations
    app.model.createReservation("MAK", "C-2-206", testUsername, d.valueOf(), d1.valueOf());
    app.model.createReservation("MAK", "C-2-208", testUsername, d.valueOf(), d1.valueOf());
    app.model.createReservation("MAK", "C-2-210", testUsername, d.valueOf(), d1.valueOf());


    app.model.createReservation("MAK", "C-2-208", testUsername, d4.valueOf(), d5.valueOf());
    app.model.createReservation("MAK", "C-2-210", testUsername, d4.valueOf(), d5.valueOf());

    //gets reservations that are happening during a period of time
    //one day, between 8am and 11pm (d2 and d3) get the reservations
    app.controller.getAvailableReservations(d2.valueOf(), d3.valueOf());


    //day before
    app.model.createReservation("MAK", "C-2-208", testUsername, d6.valueOf(), d7.valueOf());
    app.model.createReservation("MAK", "C-2-210", testUsername, d6.valueOf(), d7.valueOf());

    app.controller.getAvailableReservations(d6.valueOf(), d7.valueOf());
    app.model.deleteReservation("MAK", "C-2-210", d6.valueOf());



    app.controller.getAvailableReservations(d2.valueOf(), d3.valueOf());
    app.controller.init();
    //returns all reservations (5 total)
    //app.model.getAllReservations();
    //returns 2 reservations, they all start at time d
    //app.model.getAllReservations(d.valueOf());


    //    //
//    var room = app.model.getRooms();
//    console.log(room);
//    for (var key in room){
//        console.log(room[key]);
//    }




//    for (var key in app.model.storage.reservations.reservationList) {
//        console.log("obj." + key + " = " + app.model.storage.rooms.roomList[key]);
//        console.info(app.model.storage.reservations.reservationList[key]);
//    }
//
//    //var testRoom = app.model.storage.rooms[0];
//    //app.model.storage.rooms.map(function(obj){
//    //  console.log(obj === testRoom);
//    //  return false;
//    //});
//    //
//    //console.log(app.model.storage.rooms.indexOf(testRoom));
//    ////console.log(app.model.deleteRoom("MAK", "C-2-210"));
//
//    var tempRoom = {
//        "key": "MAKC-2-210",
//        "building": "MAK",
//        "roomNumber": "C-2-210",
//        "seating": 25
//    };
//
//    //app.model.storage.rooms.map(function(room){
//    //  //console.log(room.building === tempRoom.building && room.roomNumber === tempRoom.roomNumber);
//    //
//    //});
//
//    app.model.createRoom("MAK", "C-2-210", 25, false, false, false, false);
//    console.log(app.model.deleteRoom("MAK", "C-2-210"));
//    //room was already deleted (does not exist)
//    console.log(app.model.deleteRoom("MAK", "C-2-210"));
//
//    var room = app.model.storage.rooms["MAKC-2-210"];
//    app.model.deleteRoom(room.building, room.roomNumber);
//
//    console.log(room);

    //what info do we need for a reservation
    //room
    //app.model.createReservation(tempRoom.key, app.controller.currentUser, app.controller.defaultStartTime, app.controller.defaultEndTime);

    //console.log(app.model.createRoom("MAK", "C-2-206", 25, false, false, false, false));

</script>

</html>
